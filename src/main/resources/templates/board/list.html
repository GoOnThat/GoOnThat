<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>List</title>
    <style type="text/css">
        body {
            line-height: 2em;
            font-family: "맑은 고딕";
        }

        ul, li {
            list-style: none;
            text-align: center;
            padding: 0;
            margin: 0;
        }

        #mainWrapper {
            width: 800px;
            margin: 0 auto; /* 가운데 정렬 */
        }

        #mainWrapper > ul > li:first-child {
            text-align: center;
            font-size: 14pt;
            height: 40px;
            vertical-align: middle;
            line-height: 30px;
        }

        #ulTable {
            margin-top: 10px;
        }

        #ulTable > li:first-child > ul > li {
            background-color: #c9c9c9;
            font-weight: bold;
            text-align: center;
        }

        #ulTable > li > ul {
            clear: both;
            padding: 0;
            margin: 0 auto;
            position: relative;
            min-width: 40px;
        }

        #ulTable > li > ul > li {
            float: left;
            font-size: 10pt;
            border-bottom: 1px solid silver;
            vertical-align: baseline;
        }

        #ulTable > li > ul > li:first-child {
            width: 10%;
        }

        /* No 열 크기 */
        #ulTable > li > ul > li:first-child + li {
            width: 45%;
        }

        /* 제목 열 크기 */
        #ulTable > li > ul > li:first-child + li + li {
            width: 20%;
        }

        /* 작성일 열 크기 */
        #ulTable > li > ul > li:first-child + li + li + li {
            width: 15%;
        }

        /* 작성자 열 크기 */
        #ulTable > li > ul > li:first-child + li + li + li + li {
            width: 10%;
        }
        /* 페이징  */
        #divPaging ul li {
            display: inline-block;  /* 이 부분을 추가 */
            margin-right: 5px;     /* 오른쪽 여백 추가 (선택적) */
        }
        /* 조회수 열 크기 */

        #divPaging {
            clear: both;
            margin: 0 auto;
            width: 220px;
            height: 50px;
        }

        #divPaging > div {
            float: left;
            width: 30px;
            margin: 0 auto;
            text-align: center;
        }

        #liSearchOption {
            clear: both;
        }
        #categorySelect{

        }
        #liSearchOption > div {
            margin: 0 auto;
            margin-top: 30px;
            width: auto;
            height: 100px;
        }
        .left {
            text-align: left;
        }

        .center {
            text-align: center;
        }

    </style>
</head>
<body>
<div id="mainWrapper">
    <ul>
        <!-- 게시판 제목 -->
        <li><a href="/board/list">자유게시판</a></li>
        <ul>
            <li>
                <select id="categorySelect">
                    <option value="title">제목</option>
                    <option value="content">내용</option>
                    <option value="writer">작성자</option>
                </select>
            </li>
        </ul>

        <!-- 게시판 목록 -->
        <li>
            <ul id="ulTable">
                <li>
                    <ul>
                        <li>No</li>
                        <li>제목</li>
                        <li>작성일</li>
                        <li>작성자</li>
                        <li>조회수</li>
                    </ul>
                </li>
                <!-- 검색 결과가 없을 때 보여줄 메시지 -->
                <li th:if="${boardList.isEmpty()}">
                    <p>검색 결과가 없습니다.</p>
                </li>
                    <!-- 게시물이 출력될 영역 -->
                <li th:each="board : ${boardList}">
                    <ul>
                            <!-- 게시판 글 번호 별 세부 조회 페이지 링크 -->
                        <li th:text="${board.boardNo}"></li>
                        <li class="left">
                            <a th:href="@{/board/detail/{boardNo}(boardNo=${board.boardNo})}"
                            th:text="${board.boardTitle}"></a>
                        </li>
                        <li th:text="${board.getCreatedAt()}"></li>
                        <li th:text="${board.getBoardWriter()}"></li>
                        <li th:text="${board.boardHits}"></li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
</div>

<div id="divPaging">
    <ul>
        <!-- "처음"과 "이전" 링크 추가 -->
        <li>
            <a th:if="${nowPage > 1}" th:href="@{/board/list(page=0)}">처음</a>
            <span th:unless="${nowPage > 1}">처음</span>
        </li>
        <li>
            <a th:if="${nowPage > 1}" th:href="@{/board/list(page=${nowPage - 2})}">이전</a>
            <span th:unless="${nowPage > 1}">이전</span>
        </li>

        <!-- 페이징 링크 -->
        <li th:each="page : ${#numbers.sequence(startPage, endPage)}">
            <a th:if="${page != nowPage}" th:href="@{/board/list(page=${page - 1})}" th:text="${page}"></a>
            <span th:if="${page == nowPage}" th:text="${page}" style="color: red;"></span>
        </li>

        <!-- "다음"과 "끝" 링크 추가 -->
        <li>
            <a th:if="${nowPage < totalPages}" th:href="@{/board/list(page=${nowPage})}">다음</a>
            <span th:unless="${nowPage < totalPages}">다음</span>
        </li>
        <li>
            <a th:if="${nowPage < totalPages}" th:href="@{/board/list(page=${totalPages -1})}">끝</a>
            <span th:unless="${nowPage < totalPages}">끝</span>
        </li>
    </ul>
</div>

<div class="center">
    <button onclick="location.href='/board/write'">글쓰기</button>
    <div>
        <!-- 검색 폼 영역 -->
        <li id='liSearchOption'>
            <div>
                <form action="/board/list" method="get">
                    <select name="key">
                        <option value="title">제목</option>
                        <option value="content">내용</option>
                        <option value="writer">작성자</option>
                    </select>
                    <input type="text" name="searchKeyword" placeholder="검색어를 입력하세요">
                    <button type="submit">검색</button>
                </form>
            </div>
        </li>
    </div>
</div>
<script>
    $(document).ready(function() {
        $("#categorySelect").change(function() {
            const category = $(this).val(); // 선택한 카테고리 값 가져오기
            getPostsByCategory(category); // 해당 카테고리의 게시물 목록 가져오기
        });
    });

    // 선택한 카테고리의 게시물 목록을 서버로부터 비동기적으로 가져오는 함수
    function getPostsByCategory(category) {
        $.ajax({
            url: "/board/list", // 서버의 엔드포인트 주소
            type: "GET",
            data: { key: category }, // 서버로 보낼 데이터
            success: function(data) {
                // 서버로부터 받은 데이터를 가지고 게시물 목록 생성
                const postList = $("#postList");
                postList.empty(); // 기존 게시물 목록 삭제

                // 받은 데이터를 기반으로 게시물 목록을 동적으로 생성
                for (let i = 0; i < data.length; i++) {
                    const post = data[i];
                    const postItem = $("<div>").text(post.boardTitle);
                    postList.append(postItem);
                }
            },
            error: function(xhr, status, error) {
                console.error("Error occurred:", error);
            }
        });
    }
</script>
</body>
</html>
