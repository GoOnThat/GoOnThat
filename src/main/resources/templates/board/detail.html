<!DOCTYPE html>
<html lang="en"xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta class="test" name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">

    <title>Impact Bootstrap Template - Blog Details</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="/assets/img/favicon.png" rel="icon"/>
    <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon"/>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Raleway:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet"/>

    <!-- Vendor CSS Files -->
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet"/>
    <link href="/assets/vendor/aos/aos.css" rel="stylesheet"/>
    <link href="/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet"/>
    <link href="/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet"/>

    <!-- Template Main CSS File -->
    <link href="/assets/css/main.css" rel="stylesheet"/>

    <!-- =======================================================
    * Template Name: Impact
    * Updated: May 30 2023 with Bootstrap v5.3.0
    * Template URL: https://bootstrapmade.com/impact-bootstrap-business-website-template/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
</head>

<body>

<section id="topbar" class="topbar d-flex align-items-center">
    <div class="container d-flex justify-content-center justify-content-md-between">
        <div class="contact-info d-flex align-items-center" th:if="${user != null}">
            <i class="bi bi-envelope d-flex align-items-center"><a href="/messages/received"><span>받은 쪽지함</span></a></i>
            <i class="bi bi-person d-flex align-items-center ms-4"><span th:text="${user.major}"></span><span th:text="${user.nickname}"></span><span>님 환영합니다.</span></i>
        </div>

        <div class="contact-info d-flex align-items-center" th:if="${user == null}">
            <i class="bi bi-person-add d-flex align-items-center"><a href="/auth/join"><span>회원가입 신청</span></a></i>
        </div>
    </div>
</section><!-- End Top Bar -->

<header id="header" class="header d-flex align-items-center">

    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
        <a href="/" class="logo d-flex align-items-center">
            <!-- Uncomment the line below if you also wish to use an image logo -->
            <!-- <img src="assets/img/logo.png" alt=""> -->
            <h1>MetaMate<span>.</span></h1>
        </a>
        <nav id="navbar" class="navbar">
            <ul>
                <li><a href="#hero">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#team">Team</a></li>
                <li><a href="#recent-posts">Board</a></li>
                <li class="dropdown"><a href="#"><span>Details</span> <i class="bi bi-chevron-down dropdown-indicator"></i></a>
                    <ul>
                        <li class="dropdown"><a href="#recent-posts"><span>Board</span> <i class="bi bi-chevron-down dropdown-indicator"></i></a>
                            <ul>
                                <!--게사판 리스트로 갈 수 있게 설정-->
                                <li><a onclick="location.href='/board/list'">All Board list</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <!--마이페이지로 넘어가게 설정-->
                <li th:if="${user != null}"><a href="/auth/edit">My Page</a></li>
            </ul>
        </nav><!-- .navbar -->

        <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
        <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>

    </div>
</header><!-- End Header -->
<!-- End Header -->

<main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <div class="breadcrumbs">
        <div class="page-header d-flex align-items-center" style="background-image: url('');">
            <div class="container position-relative">
                <div class="row d-flex justify-content-center">
                    <div class="col-lg-6 text-center">
                        <h2>Blog Details</h2>
                        <p>게시글 세부사항</p>
                    </div>
                </div>
            </div>
        </div>
        <nav>
            <div class="container">
                <ol>
                    <li><a href="index.html">Home</a></li>
                    <li>Blog Details</li>
                </ol>
            </div>
        </nav>
    </div><!-- End Breadcrumbs -->

    <!-- ======= Blog Details Section ======= -->
    <section id="blog" class="blog">
        <div class="container" data-aos="fade-up">

            <div class="row g-5">

                <div class="col-lg-8">

                    <article class="blog-details">

                        <!-- <div class="post-img">
                          <img src="assets/img/blog/blog-1.jpg" alt="" class="img-fluid">
                        </div> -->

                        <h2 class="title" th:text="${boardDetail.boardTitle}"></h2>

                        <div class="meta-top">
                            <ul>
                                <!--작성자, 작성 일시, 댓글 수 넣는 곳-->
                                <li class="d-flex align-items-center"><i class="bi bi-person"  th:text="${boardDetail.boardWriter}"></i></li>
                                <li class="d-flex align-items-center" ><i class="bi bi-clock" th:text="${boardDetail.getCreatedAt()}"></i></li>
                                <li class="d-flex align-items-center"><i class="bi bi-hand-thumbs-up"></i> <a href="blog-details.html">12 like</a></li>
                                <li class="d-flex align-items-center" ><i class="bi bi-at" th:text="${boardDetail.boardCategory}"></i></li>
                                <li class="d-flex align-items-center"><i class="bi bi-hand-index"  th:text="${boardDetail.boardHits}"></i></li>
                            </ul>
                        </div><!-- End meta top -->

                        <div class="content">
                            <p th:text="${boardDetail.boardContent}"></p>
                        </div>

                    </article><!-- End blog post -->
                    <br><br>
                    <h4 class="comments-count"><strong>댓글 목록</strong></h4>
                    <div class="post-author d-flex align-items-center" th:each="comment : ${boardDetail.commentList}">
                        <!-- <img src="assets/img/blog/blog-author.jpg" class="rounded-circle flex-shrink-0" alt=""> -->
                        <div>
                            <p>▾ 작성자</p><h5 th:if="${!comment.isCommentIsDeleted()}" th:text="${comment.getCommentWriter()}" style=""></h5>
                                <p>▾ 내용</p><span th:id="'comment-content-' + ${comment.commentNo}" th:text="${comment.commentContent}"></span>
                                <input type="text" class="edit-comment-input" th:id="'edit-comment-input-' + ${comment.commentNo}" th:value="${comment.commentContent}" style="display: none;">
                            <p>▾ 작성 시간</p><time th:if="${!comment.isCommentIsDeleted}" th:text="${comment.getCreatedDate()}"></time>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                            <button class="btn btn-outline-primary btn-sm" th:id="'edit-button-' + ${comment.commentNo}" th:onclick="'editComment(\'' + ${comment.commentNo} + '\')'">수정</button>
                            <button class="btn btn-outline-danger btn-sm" th:id="'update-button-' + ${comment.commentNo}" th:onclick="'updateComment(\'' + ${comment.commentNo} + '\')'" style="display: none;">확인</button>
                            <button class="btn btn-outline-danger btn-sm" th:onclick="'deleteComment(\'' + ${comment.commentNo} + '\')'">삭제</button>
                        </div>
                    </div><!-- End post author -->

                    <div class="comments">
                        <!--댓글 작성 폼-->
                        <input type="hidden" name="refBoardNo" th:value="${boardDetail.boardNo}">
                        <div class="reply-form" id="commentList">
                            <h4>Comment</h4>
                            <p>당신의 답글을 작성해주세요</p>
                            <div class="row">
                            </div>
                            <div class="row">
                                <div class="col form-group">
                                    <textarea name="replyContents" class="form-control" placeholder="댓글을 작성해주세요" id="replyContents" required="required"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" th:onclick="'submitComment(\'' + ${boardDetail.boardNo} + '\')'">댓글 작성</button>
                        </div>

                    </div><!-- End blog comments -->
                    <br>
                    <br>
                    <div style="display: inline-flex; align: center">
                        <form th:action="@{'/board/edit/' + ${boardNo}}" method="get">
                            <input type="hidden" th:name="_csrf" th:value="${_csrf.token}" />
                            <button type="submit" class="btn btn-primary btn-lg">수정</button>
                        </form>
                        <form th:action="@{'/board/detail/' + ${boardNo}}" method="post">
                            <input type="hidden" th:name="_csrf" th:value="${_csrf.token}" />
                            <button type="submit" class="btn btn-danger btn-lg">삭제</button>
                        </form>
                        <button onclick="location.href='/board/list'" class="btn btn-dark btn-lg">목록</button>
                    </div>
                </div>
            </div>
        </div>

        </div>
    </section><!-- End Blog Details Section -->

</main><!-- End #main -->

<!-- ======= Footer ======= -->
<footer id="footer" class="footer">

    <div class="container">
        <div class="row gy-4">
            <div class="col-lg-5 col-md-12 footer-info">
                <a href="index.html" class="logo d-flex align-items-center">
                    <span>MetaMate</span>
                </a>
                <p>Cras fermentum odio eu feugiat lide par naso tierra. Justo eget nada terra videa magna derita valies darta donna mare fermentum iaculis eu non diam phasellus.</p>
                <div class="social-links d-flex mt-4">
                    <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
                    <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
                    <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
                </div>
            </div>

            <div class="col-lg-2 col-6 footer-links">
                <h4>Useful Links</h4>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">About us</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Terms of service</a></li>
                    <li><a href="#">Privacy policy</a></li>
                </ul>
            </div>

            <div class="col-lg-2 col-6 footer-links">
                <h4>Our Services</h4>
                <ul>
                    <li><a href="#">서버개발</a></li>
                    <li><a href="#">3D모델링</a></li>
                    <li><a href="#">콘텐츠기획</a></li>
                    <li><a href="#">Unity</a></li>
                    <li><a href="#">Unreal</a></li>
                    <li><a href="#">자율전공</a></li>
                    <li><a href="#">AI</a></li>
                </ul>
            </div>

            <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
                <h4>Contact Us</h4>
                <p>
                    C-106 강의장 <br>
                    메타버스 아카데미<br>
                    TEAM : GO-ON-THAT<br><br>
                    <strong>Phone:</strong> +82 010-5518-2290<br>
                    <strong>Email:</strong> pyunghun120@gmail.com<br>
                </p>

            </div>

        </div>
    </div>

    <div class="container mt-4">
        <div class="copyright">
            &copy; Copyright <strong><span>Impact</span></strong>. All Rights Reserved
        </div>
        <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/impact-bootstrap-business-website-template/ -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
    </div>

</footer><!-- End Footer -->
<!-- End Footer -->

<a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<div id="preloader"></div>
<script>
    function submitComment(boardNo) {
        const replyContents = $("#replyContents").val();
        const csrfToken = $("meta[name='_csrf']").attr("content");

        $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
            if (options['type'].toLowerCase() === "post") {
                jqXHR.setRequestHeader('X-CSRF-TOKEN', csrfToken);
            }
        });

        $.ajax({
            url: `/comment/${boardNo}`,
            data: {
                refBoardNo: boardNo,
                commentContent: replyContents
            },
            type: "POST",
            success: function (data, status, xhr) {
                // 등록 성공시 처리
                console.log(data);
                alert("댓글 등록이 완료되었습니다.");
                location.reload();
                // 댓글 목록을 다시 로딩하는 등의 작업 수행
            },
            error: function (data) {
                // 등록 실패시 처리
                console.log(data);
                alert("권한이 없습니다.");
            }
        });
    }


    function deleteComment(commentNo) {
        var csrfToken = $("meta[name='_csrf']").attr("content");
        var url = "/comment/" + commentNo;

        console.log(commentNo);
        $.ajax({
            url: url,
            type: "DELETE",
            beforeSend: function(xhr) {
                xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
            },
            success: function(data, status, xhr) {
                // 수정 성공 시 처리
                console.log(data);
                alert("댓글 삭제가 완료되었습니다.");
                location.reload();
                // 댓글 목록을 다시 로딩하는 등의 작업 수행
            },
            error: function(data) {
                // 삭제 실패 시 처리
                console.log(data);
                alert("권한이 없습니다.");
            }
        });
    }

    function updateComment(commentNo) {
        var csrfToken = $("meta[name='_csrf']").attr("content");
        var url = "/edit/" + commentNo;
        var updatedCommentContent = $("#edit-comment-input-" + commentNo).val();

        $.ajax({
            url: url,
            type: "PUT",
            beforeSend: function (xhr) {
                xhr.setRequestHeader('X-CSRF-TOKEN', csrfToken);
            },
            data: { commentContent: updatedCommentContent },
            success: function (data, status, xhr) {
                console.log(data);
                alert("댓글 수정이 완료되었습니다.");
                location.reload();
            },
            error: function (xhr, status, error) {
                console.log(xhr);
                alert("권한이 없습니다.");
            }
        });
    }

    function editComment(commentNo) {
        var commentContentSpan = $("#comment-content-" + commentNo);
        var commentContentInput = $("#edit-comment-input-" + commentNo);
        var updateButton = $("#update-button-" + commentNo);
        var editButton = $("#edit-button-" + commentNo);

        commentContentSpan.hide();
        commentContentInput.show();
        updateButton.show();
        editButton.hide();
    }
</script>
<!-- Vendor JS Files -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/aos/aos.js"></script>
<script src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="/assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="/assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="/assets/vendor/php-email-form/validate.js"></script>

<!-- Template Main JS File -->
<script src="/assets/js/main.js"></script>

</body>

</html>